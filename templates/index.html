<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wind Turbine Power Intelligence</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container py-4">
    <header class="mb-4 text-center">
      <h1>Weather-Based Wind Turbine Power Prediction</h1>
      <p class="lead">Fetch live weather data or input your own measurements to estimate real-time turbine output.</p>
    </header>

    <div class="row g-4">
      <section class="col-md-6">
        <div class="card h-100 shadow-sm">
          <div class="card-body">
            <h2 class="card-title h4">A. Get Current Weather</h2>
            <form action="{{ url_for('weather') }}" method="POST" class="mt-3">
              <div class="mb-3">
                <label for="city" class="form-label">City Name</label>
                <input id="city" type="text" name="city" class="form-control" placeholder="e.g., Copenhagen" required>
              </div>
              <button class="btn btn-primary" type="submit">Fetch Weather</button>
            </form>
            {% if weather_error %}
              <div class="alert alert-danger mt-3" role="alert">{{ weather_error }}</div>
            {% endif %}
            {% if weather_data %}
              <div class="weather-card mt-4">
                <h3>{{ weather_data.city }}</h3>
                <p class="mb-1 text-muted">{{ weather_data.description }}</p>
                <ul class="list-unstyled mb-0">
                  <li><strong>Wind Speed:</strong> {{ weather_data.wind_speed }} m/s</li>
                  <li><strong>Direction:</strong> {{ weather_data.wind_direction }}°</li>
                  <li><strong>Temperature:</strong> {{ weather_data.temperature }} °C</li>
                  <li><strong>Humidity:</strong> {{ weather_data.humidity }}%</li>
                  <li><strong>Pressure:</strong> {{ weather_data.pressure }} hPa</li>
                </ul>
                <p class="small mt-2 mb-0">Values auto-fill the prediction form where possible.</p>
              </div>
            {% endif %}
          </div>
        </div>
      </section>

      <section class="col-md-6">
        <div class="card h-100 shadow-sm">
          <div class="card-body">
            <h2 class="card-title h4">B. Predict Turbine Power Output</h2>
            {% if prediction_error %}
              <div class="alert alert-warning" role="alert">{{ prediction_error }}</div>
            {% endif %}
            {% if prediction is not none and not prediction_error %}
              <div class="alert alert-success" role="alert">
                Estimated Power Output: <strong>{{ '%.2f'|format(prediction) }} kW</strong>
              </div>
            {% endif %}
            <form action="{{ url_for('predict') }}" method="POST" class="mt-3">
              {% if feature_columns %}
                {% for feature in feature_columns %}
                  <div class="mb-3">
                    <label class="form-label" for="{{ feature }}">{{ feature.replace('_', ' ').title() }}</label>
                    <input
                      id="{{ feature }}"
                      type="number"
                      step="any"
                      name="{{ feature }}"
                      class="form-control"
                      placeholder="Enter {{ feature.replace('_', ' ') }}"
                      value="{{ feature_defaults.get(feature, '') }}"
                      required>
                  </div>
                {% endfor %}
              {% else %}
                <p class="text-muted">Model features are not available. Train the model first.</p>
              {% endif %}
              <button class="btn btn-success" type="submit" {% if not feature_columns %}disabled{% endif %}>Predict Power</button>
            </form>
            <p class="small text-muted mt-3 mb-0">Provide Theoretical Power Curve values manually if not sourced from weather APIs.</p>
          </div>
        </div>
      </section>
    </div>

    <section class="mt-5">
      <h2 class="h4">Insights & Diagnostics</h2>
      <p>Explore the automatically generated exploratory plots below to understand key drivers of turbine performance.</p>
      <div class="plot-grid">
        <img src="{{ url_for('static', filename='plots/correlation_heatmap.png') }}" alt="Correlation Heatmap" loading="lazy">
        <img src="{{ url_for('static', filename='plots/wind_speed_vs_power.png') }}" alt="Wind Speed vs Power" loading="lazy">
        <img src="{{ url_for('static', filename='plots/theoretical_vs_power.png') }}" alt="Theoretical vs Power" loading="lazy">
        <img src="{{ url_for('static', filename='plots/power_distribution.png') }}" alt="Power Distribution" loading="lazy">
      </div>
    </section>
  </div>
</body>
</html>
